# рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮ рЃЏрЃўрЃњрЃарЃљрЃфрЃўрЃўрЃА рЃўрЃюрЃАрЃбрЃарЃБрЃЦрЃфрЃўрЃљ ­Ъћљ

## ­ЪЊІ рЃЏрЃўрЃњрЃарЃљрЃфрЃўрЃўрЃА рЃюрЃљрЃЉрЃўрЃ»рЃћрЃЉрЃў

### 1. рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃўрЃЌрЃў Dependency-рЃћрЃЉрЃў
```bash
# Museum space рЃцрЃЮрЃџрЃЊрЃћрЃарЃерЃў рЃерЃћрЃЊрЃў
cd "C:\Users\user\Desktop\Museum space"

# рЃЊрЃљрЃљрЃЏрЃљрЃбрЃћ validator library
npm init -y  # рЃЌрЃБ package.json рЃљрЃа рЃљрЃарЃАрЃћрЃЉрЃЮрЃЉрЃА
npm install validator
```

### 2. рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮ рЃцрЃљрЃўрЃџрЃћрЃЉрЃўрЃА рЃЎрЃЮрЃърЃўрЃарЃћрЃЉрЃљ
```bash
# рЃФрЃЋрЃћрЃџрЃў рЃцрЃљрЃўрЃџрЃћрЃЉрЃўрЃА backup
cp api/unipay-callback.js api/unipay-callback-old.js
cp api/unipay-create-order.js api/unipay-create-order-old.js

# рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮ рЃЋрЃћрЃарЃАрЃўрЃћрЃЉрЃўрЃА рЃЎрЃЮрЃърЃўрЃарЃћрЃЉрЃљ
cp "../Museum_Security_Backup/api_secure/unipay-callback-secure.js" "api/unipay-callback.js"
cp "../Museum_Security_Backup/api_secure/unipay-create-order-secure.js" "api/unipay-create-order.js"
```

### 3. Environment Variables рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃљ
```bash
# .env рЃцрЃљрЃўрЃџрЃерЃў рЃБрЃюрЃЊрЃљ рЃўрЃДрЃЮрЃА:
UNIPAY_MERCHANT_ID=5015191030581
UNIPAY_API_KEY=bc6f5073-6d1c-4abe-8456-1bb814077f6e

# Vercel Dashboard-рЃерЃўрЃф рЃБрЃюрЃЊрЃљ рЃўрЃДрЃЮрЃА рЃћрЃА рЃфрЃЋрЃџрЃљрЃЊрЃћрЃЉрЃў рЃЊрЃљрЃДрЃћрЃюрЃћрЃЉрЃБрЃџрЃў!
```

### 4. Test рЃЊрЃљ Deploy
```bash
# рЃфрЃЋрЃџрЃўрЃџрЃћрЃЉрЃћрЃЉрЃўрЃА commit
git add .
git commit -m "security: implement secure API endpoints

- Fixed CORS wildcard vulnerability
- Removed sensitive data logging  
- Added input validation and sanitization
- Improved error handling"

# Push to trigger deployment
git push origin master
```

## ­ЪћЇ рЃарЃљ рЃерЃћрЃўрЃфрЃЋрЃљрЃџрЃљ

### РюЁ рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮрЃћрЃЉрЃўрЃА рЃњрЃљрЃБрЃЏрЃ»рЃЮрЃЉрЃћрЃАрЃћрЃЉрЃћрЃЉрЃў

#### CORS Policy рЃцрЃўрЃЦрЃАрЃў:
```javascript
// рЃФрЃЋрЃћрЃџрЃў (рЃАрЃљрЃерЃўрЃерЃў):
res.setHeader('Access-Control-Allow-Origin', '*');

// рЃљрЃ«рЃљрЃџрЃў (рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮ):
const allowedOrigins = ['https://museum-space-b10.vercel.app'];
// рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃерЃћрЃюрЃў рЃАрЃљрЃўрЃбрЃў рЃерЃћрЃФрЃџрЃћрЃЉрЃА API-рЃА рЃЏрЃўрЃЏрЃљрЃарЃЌрЃЋрЃљрЃА
```

#### Sensitive Data Logging-рЃўрЃА рЃЏрЃЮрЃерЃЮрЃарЃћрЃЉрЃљ:
```javascript
// рЃФрЃЋрЃћрЃџрЃў (рЃАрЃљрЃерЃўрЃерЃў):
console.log('Starting UniPay payment for:', { firstName, lastName, phone, amount });

// рЃљрЃ«рЃљрЃџрЃў (рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮ):
console.log('Payment initiated:', { orderId, amount, timestamp });
// рЃърЃўрЃарЃљрЃЊрЃў рЃўрЃюрЃцрЃЮрЃарЃЏрЃљрЃфрЃўрЃљ рЃљрЃдрЃљрЃа рЃўрЃЉрЃћрЃГрЃЊрЃћрЃЉрЃљ
```

#### Input Validation рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃљ:
```javascript
// рЃљрЃ«рЃљрЃџрЃў рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮрЃћрЃЉрЃљ:
const sanitizeInput = {
  name: (input) => validator.escape(input.trim()),
  phone: (input) => input.replace(/[^\d+]/g, ''),
  amount: (input) => Math.round(parseFloat(input) * 100) / 100
};
```

### ­ЪћД рЃбрЃћрЃЦрЃюрЃўрЃЎрЃБрЃарЃў рЃњрЃљрЃБрЃЏрЃ»рЃЮрЃЉрЃћрЃАрЃћрЃЉрЃћрЃЉрЃў

1. **рЃЏрЃЮрЃЊрЃБрЃџрЃљрЃарЃБрЃџрЃў рЃЎрЃЮрЃЊрЃў** - рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃў рЃЊрЃљрЃюрЃљрЃгрЃћрЃЋрЃарЃћрЃЉрЃБрЃџрЃўрЃљ
2. **рЃЎрЃЮрЃюрЃАрЃбрЃљрЃюрЃбрЃћрЃЉрЃў** - hardcoded values-рЃћрЃЉрЃў рЃњрЃљрЃбрЃљрЃюрЃўрЃџрЃўрЃљ рЃфрЃљрЃџрЃЎрЃћ
3. **рЃћрЃарЃЮрЃа рЃ░рЃћрЃюрЃЊрЃџрЃўрЃюрЃњрЃў** - рЃБрЃЎрЃћрЃЌрЃћрЃАрЃў error messages
4. **рЃЋрЃљрЃџрЃўрЃЊрЃљрЃфрЃўрЃљ** - рЃДрЃЋрЃћрЃџрЃљ input рЃЕрЃћрЃЎрЃЊрЃћрЃЉрЃљ рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮрЃћрЃЉрЃљрЃќрЃћ

## Рџа№ИЈ рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЋрЃљрЃюрЃў

### рЃбрЃћрЃАрЃбрЃўрЃарЃћрЃЉрЃљ рЃЏрЃўрЃњрЃарЃљрЃфрЃўрЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ:
1. **Payment flow** - рЃАрЃарЃБрЃџрЃў рЃњрЃљрЃЊрЃљрЃ«рЃЊрЃўрЃА рЃърЃарЃЮрЃфрЃћрЃАрЃў рЃљрЃЏрЃЮрЃгрЃЏрЃћ
2. **Error handling** - рЃљрЃарЃљрЃАрЃгрЃЮрЃарЃў inputs рЃбрЃћрЃАрЃбрЃўрЃарЃћрЃЉрЃљ  
3. **CORS** - рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃерЃћрЃюрЃў рЃАрЃљрЃўрЃбрЃўрЃЊрЃљрЃю API рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА
4. **Logs** - рЃърЃўрЃарЃљрЃЊрЃў рЃўрЃюрЃцрЃЮрЃарЃЏрЃљрЃфрЃўрЃљ рЃљрЃдрЃљрЃа рЃЕрЃљрЃюрЃА logs-рЃерЃў

### рЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮрЃћрЃЉрЃўрЃА рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃљ:
```bash
# CORS рЃбрЃћрЃАрЃбрЃў - рЃћрЃА рЃБрЃюрЃЊрЃљ рЃЕрЃљрЃЋрЃљрЃарЃЊрЃћрЃА:
curl -X POST http://evil-site.com/test-cors

# Rate limiting рЃбрЃћрЃАрЃбрЃў (рЃЏрЃЮрЃЏрЃљрЃЋрЃљрЃџрЃерЃў рЃЊрЃљрЃћрЃЏрЃљрЃбрЃћрЃЉрЃљ):
# for i in {1..20}; do curl -X POST your-api; done
```

## ­ЪЊъ Support

### рЃЌрЃБ рЃарЃљрЃЏрЃћ рЃърЃарЃЮрЃЉрЃџрЃћрЃЏрЃљ рЃерЃћрЃЦрЃЏрЃюрЃўрЃџрЃўрЃљ:

1. **Rollback**: 
```bash
cp api/unipay-callback-old.js api/unipay-callback.js
cp api/unipay-create-order-old.js api/unipay-create-order.js
```

2. **рЃџрЃЮрЃњрЃћрЃЉрЃўрЃА рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃљ**: Vercel Dashboard Рєњ Functions Рєњ Logs

3. **UniPay рЃбрЃћрЃАрЃбрЃў**: рЃЏрЃфрЃўрЃарЃћ рЃЌрЃљрЃюрЃ«рЃўрЃЌ (1 рЃџрЃљрЃарЃў) рЃАрЃфрЃљрЃЊрЃћ рЃњрЃљрЃЊрЃљрЃ«рЃЊрЃљ

## РюЁ рЃЏрЃўрЃњрЃарЃљрЃфрЃўрЃўрЃА рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃўрЃА рЃЎрЃарЃўрЃбрЃћрЃарЃўрЃБрЃЏрЃћрЃЉрЃў

- [ ] Payment flow рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА
- [ ] Logs-рЃерЃў рЃърЃўрЃарЃљрЃЊрЃў рЃўрЃюрЃцрЃЮрЃарЃЏрЃљрЃфрЃўрЃљ рЃљрЃа рЃЕрЃљрЃюрЃА  
- [ ] CORS рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃерЃћрЃюрЃў domain-рЃЊрЃљрЃю рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА
- [ ] Input validation рЃЉрЃџрЃЮрЃЎрЃљрЃЋрЃА рЃЏрЃљрЃЋрЃюрЃћ inputs-рЃА
- [ ] UniPay callback рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА рЃгрЃўрЃюрЃљрЃюрЃЊрЃћрЃџрЃў рЃљрЃџрЃњрЃЮрЃарЃўрЃЌрЃЏрЃўрЃЌ

---

**рЃерЃћрЃЏрЃЊрЃћрЃњрЃў рЃюрЃљрЃЉрЃўрЃ»рЃў**: рЃЌрЃБ рЃДрЃЋрЃћрЃџрЃљрЃцрЃћрЃарЃў рЃЏрЃБрЃерЃљрЃЮрЃЉрЃА, рЃерЃћрЃЏрЃЊрЃћрЃњрЃў security features рЃЊрЃљрЃЋрЃљрЃЏрЃљрЃбрЃЮрЃЌ (rate limiting, webhook verification).